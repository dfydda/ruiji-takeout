<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>瑞吉外卖管理端</title>
    <link rel="shortcut icon" href="favicon.ico">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="plugins/element-ui/index.css" />
    <link rel="stylesheet" href="styles/common.css" />
    <link rel="stylesheet" href="styles/index.css" />
    <link rel="stylesheet" href="styles/icon/iconfont.css" />
    <style>
      .body{
        min-width: 1366px;
      }
      .app-main{
        height: calc(100% - 64px);
      }
      .app-main .divTmp{
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div class="app" id="app">
      <div class="app-wrapper openSidebar clearfix">
        <!-- sidebar -->
        <div class="sidebar-container">
          <div class="logo" v-if="!isCollapse">
            <!-- <img src="images/logo.png" width="122.5" alt="" /> -->
            <img src="images/login/login-logo.png" alt="" style="width: 120px; height: 31px" />
          </div>
          <div v-else class="sidebar-logo-mini" style=" width: 190px;height: 148px;">
            <img src="images/mini-logo.png" >
          </div>

          <el-aside width="collapse">
          <el-scrollbar wrap-class="scrollbar-wrapper">
            <el-menu :default-active="defAct"
              :unique-opened="false"
              :collapse="isCollapse"
              background-color="#343744"
              text-color="#bfcbd9"
              active-text-color="#f4f4f5"
            >
              <div v-for="item in menuList" :key="item.id">
                <el-submenu :index="item.id" v-if="item.children && item.children.length>0">
                  <template slot="title">
                    <i class="iconfont" :class="item.icon"></i>
                    <span>{{item.name}}</span>
                  </template>
                  <el-menu-item
                    v-for="sub in item.children"
                    :index="sub.id"
                    :key="sub.id"
                    @click="menuHandle(sub,false)"
                    >
                    <i :class="iconfont" :class="sub.icon"></i>
                    <span slot="title">{{sub.name}}</span>
                    </el-menu-item
                  >
                </el-submenu>
                <el-menu-item v-else :index="item.id" @click="menuHandle(item,false)">
                  <i class="iconfont" :class="item.icon"></i>
                  <span slot="title">{{item.name}}</span>
                </el-menu-item>
              </div>
            </el-menu>
          </el-scrollbar>
          </el-aside>

        </div>
        <div class="main-container">

          <!-- <navbar /> -->
          <div class="navbar" >
            <div class="box_bgd" @click="isC" >
              <!-- 点击展开收起导航和切换对应图标 -->
              <i class="el-icon-s-fold" v-show="block" ></i>
              <i class="el-icon-s-unfold" v-show="toggle" ></i>
            </div>

            <div class="head-lable">
              <span v-if="goBackFlag" class="goBack" @click="goBack()"
                ><img src="images/icons/btn_back@2x.png" alt="" /> 返回</span>
              <span>{{headTitle}}</span>
                <el-tag v-if="setStatus === 1"
                        type="success"
                        class="businessBtn"
                        style="width: 100px;height: 35px;font-size: 17px;text-align: center;">营业中</el-tag>
                <el-tag
                        v-else
                        type="danger"
                        class="businessBtn closing"
                        style="width: 100px;height: 35px;font-size: 17px;text-align: center">打烊中</el-tag>
            </div>


            <div class="right-menu" style="float: right">

                <img style="margin-top: 20px;" src="images/time.png" />
                <span style="cursor: pointer;" @click="handleStatus">营业状态设置</span>

<!--              <div class="avatar-wrapper">{{ userInfo.name }}</div>-->
              <!-- <div class="logout" @click="logout">退出</div> -->
              <img src="images/icons/btn_close@2x.png" class="outLogin" alt="退出" @click="logout" />
            </div>
          </div>


          <div class="app-main" v-loading="loading">
            <div class="divTmp" v-show="loading"></div>
            <iframe
              id="cIframe"
              class="c_iframe"
              name="cIframe"
              :src="iframeUrl"
              width="100%"
              height="auto"
              frameborder="0"
              v-show="!loading"
            ></iframe>
          </div>
        </div>
      </div>

      <!-- 营业状态弹层 -->
      <el-dialog
              title="营业状态设置"
              :visible.sync="dialogVisible"
              width="25%"
              :modal-append-to-body="false"
              :close-on-click-modal="false"
      >
        <el-radio-group v-model="setStatus">
          <el-radio :label="1">
            营业中
            <span>当前餐厅处于营业状态，自动接收任何订单，可点击打烊进入店铺打烊状态。</span>
          </el-radio>
          <el-radio :label="0">
            打烊中
            <span>当前餐厅处于打烊状态，仅接受营业时间内的预定订单，可点击营业中手动恢复营业状态。</span>
          </el-radio>
        </el-radio-group>
        <span slot="footer" class="dialog-footer">
      <el-button @click="dialogVisible = false">取 消</el-button>
      <el-button type="primary" @click="handleSave">确 定</el-button>
    </span>
      </el-dialog>

    </div>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="plugins/element-ui/index.js"></script>
    <!-- 引入axios -->
    <script src="plugins/axios/axios.min.js"></script>
    <script src="js/request.js"></script>
    <script src="./api/login.js"></script>
    <script>

      new Vue({
        el: '#app',
        data() {
          return {
            defAct: '2',
            menuActived: '2',
            userInfo: {},
            menuList: [
                    //图标看iconfont.json
              // {
              //   id: '1',
              //   name: '门店管理',
              //   children: [
                  {
                    id: '2',
                    name: '员工管理',
                    url: 'page/member/list.html',
                    icon: 'icon-member'
                  },
                  {
                    id: '3',
                    name: '分类管理',
                    url: 'page/category/list.html',
                    icon: 'icon-category'
                  },
                  {
                    id: '4',
                    name: '菜品管理',
                    url: 'page/food/list.html',
                    icon: 'icon-food'
                  },
                  {
                    id: '5',
                    name: '套餐管理',
                    url: 'page/combo/list.html',
                    icon: 'icon-combo'
                  },
                  {
                    id: '6',
                    name: '订单明细',
                    url: 'page/order/list.html',
                    icon: 'icon-order'
                  },
                  {
                    id: '7',
                    name: '用户管理',
                    url: 'page/user/list.html',
                    icon: 'icon-user'
                  },
                  {
                    id: '8',
                    name: '论坛管理',
                    url: 'page/forum/list.html',
                    icon: 'icon-order'
                  }

               //  ],
               // },
            ],
            iframeUrl: 'page/member/list.html',
            headTitle: '员工管理',
            goBackFlag: false,
            loading: true,
            timer: null,

            dialogVisible: false,
            setStatus: 0,
            isCollapse: false, //导航栏默认为展开
            toggle: false, //第二个图标默认隐藏
            block: true, //默认显示第一个图标
          }
        },
        computed: {},
        created() {
          const userInfo = window.localStorage.getItem('userInfo')
          if (userInfo) {
            this.userInfo = JSON.parse(userInfo)
          }
          this.closeLoading()
        },
        beforeDestroy() {
          this.timer = null
          clearTimeout(this.timer)
        },
        mounted() {
          window.menuHandle = this.menuHandle
        },
        methods: {
          // 打开营业状态弹层
          handleStatus() {
            this.dialogVisible = true
          },
          //改变营业状态，未写后端请求
          handleSave() {
            // this.setStatus = !this.setStatus;
          },
          // 动态控制展开与收起和切换对应图标
          isC() {
            this.isCollapse = !this.isCollapse;
            this.toggle = !this.toggle;
            this.block = !this.block;
          },

          logout() {
            logoutApi().then((res)=>{
              if(res.code === 1){
                localStorage.removeItem('userInfo')
                window.location.href = '/backend/page/login/login.html'
              }
            })
          },
          goBack() {
            // window.location.href = 'javascript:history.go(-1)'
            const menu = this.menuList.find(item=>item.id===this.menuActived)
            // this.goBackFlag = false
            // this.headTitle = menu.name
            this.menuHandle(menu,false)
          },

          menuHandle(item, goBackFlag) {
            this.loading = true
            this.menuActived = item.id
            this.iframeUrl = item.url
            this.headTitle = item.name
            this.goBackFlag = goBackFlag
            this.closeLoading()
          },
          closeLoading(){
            this.timer = null
            this.timer = setTimeout(()=>{
              this.loading = false
            },1000)
          },
        }
      })
    </script>

    <style scoped>
      .el-dialog {
        min-width: auto !important;
      }

      .el-dialog__header {
        height: 61px;
        line-height: 60px;
        background: #fbfbfa;
        padding: 0 30px;
        font-size: 16px;
        color: #333;
        border: none;
      }

      .el-dialog__body {
        padding: 10px 30px 30px;
      }

      .el-radio,
      .el-radio__input {
        white-space: normal;
      }

      .el-radio__label {
        padding-left: 5px;
        color: #333;
        font-weight: 700;
      }

      .el-radio__label span {
        display: block;
        line-height: 20px;
        padding-top: 12px;
        color: #666;
        font-weight: normal;
      }

      .el-radio__input.is-checked .el-radio__inner::after {
        background: #333;
      }

      .el-radio-group > .is-checked {
        border: 1px solid #ffc200;
      }

      .el-radio {
        width: 100%;
        background: #fbfbfa;
        border: 1px solid #e5e4e4;
        border-radius: 4px;
        padding: 14px 22px;
        margin-top: 20px;
      }
      </style>
  </body>
</html>
